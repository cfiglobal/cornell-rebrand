<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cornell Diesel Systems</title>
  <link rel="icon" type="image/x-icon" href="assets/logos/favicon.ico">
  <link rel="stylesheet" href="css/main.css" />
</head>
<body>
  <div class="hero-section">
    <div class="container">
      <header>
        <img src="assets/logos/cornell_logo_white_optimized.svg" alt="Cornell Diesel Systems Logo" class="main-logo" />
      </header>

      <section class="announcement">
        <h1 class="">Cornell Diesel Systems is now MTQ Engine Systems</h1>
        <p>
          We are excited to announce the consolidation of Cornell Diesel Systems with MTQ Engine Systems,
          combining our strengths to create a <span class="bold">One Stop Shop</span> for all your Diesel Fuel Injection, 
          Turbocharger, and Performance sales & service solutions.
        </p>
        <p>
            <span class="bold italic">"Same Great Service and Familiar Team"</span>
        </p>
        <p>
          This represents more than just a name change, it reflects our commitment to continuous improvement, and
          enhanced customer service. Together, Cornell and MTQ Engine Systems are positioned to deliver even greater value, 
          reliability, and nationwide support to our customers.
        </p>
        <p>
          For now, you can still access information and resources directly on the respective company websites.
        </p>
        <p>Please use links below.</p>
      </section>

      <div class="links">
        <a href="https://www.cornells.com.au" target="_blank"><div class="btn-link cornell-border"><img src="assets/logos/cornell_logo_1.png" alt="Cornell Website" /></div></a>
        <a href="https://www.mtqes.com.au" target="_blank"><div class="btn-link mtq-border"><img src="assets/logos/mtq_logo_1.png" alt="MTQ Website" /></div></a>
      </div>

      <div class="main-logo">
        <img src="assets/logos/mtq_logo_white.svg" alt="MTQ Engine Systems Full Logo" />
      </div>
    </div>
    
    <!-- Scroll Indicator -->
    <div class="scroll-button scroll-indicator mobile-hide" id="scrollIndicator"></div>
  </div>

  <div class="brands">
    <div class="container">
      <h2 class="header-text header-text-larger">HOME TO THE WORLD'S LEADING BRANDS</h2>
      <div class="brand-logos">
        <div class="brand-carousel">
          <!-- First set of brands -->
          <img src="assets/brands/borgwarner.svg" alt="BorgWarner" loading="lazy" />
          <img src="assets/brands/bosch.svg" alt="Bosch" loading="lazy" />
          <img src="assets/brands/continental.svg" alt="Continental" loading="lazy" />
          <img src="assets/brands/delphi.svg" alt="Delphi" loading="lazy" />
          <img src="assets/brands/denso.svg" alt="Denso" loading="lazy" />
          <img src="assets/brands/garrett.svg" alt="Garrett" loading="lazy" />
          <img src="assets/brands/holset.svg" alt="Holset" loading="lazy" />
          <img src="assets/brands/ihi.svg" alt="IHI" loading="lazy" />
          <img src="assets/brands/mitsubishi.svg" alt="Mitsubishi" loading="lazy" />
          <img src="assets/brands/stanadyne.svg" alt="Stanadyne" loading="lazy" />
          <img src="assets/brands/yanmar.svg" alt="Yanmar" loading="lazy" />
          <img src="assets/brands/zexel.svg" alt="Zexel" loading="lazy" />
          <!-- Duplicate set for seamless loop -->
          <img src="assets/brands/borgwarner.svg" alt="BorgWarner" loading="lazy" />
          <img src="assets/brands/bosch.svg" alt="Bosch" loading="lazy" />
          <img src="assets/brands/continental.svg" alt="Continental" loading="lazy" />
          <img src="assets/brands/delphi.svg" alt="Delphi" loading="lazy" />
          <img src="assets/brands/denso.svg" alt="Denso" loading="lazy" />
          <img src="assets/brands/garrett.svg" alt="Garrett" loading="lazy" />
          <img src="assets/brands/holset.svg" alt="Holset" loading="lazy" />
          <img src="assets/brands/ihi.svg" alt="IHI" loading="lazy" />
          <img src="assets/brands/mitsubishi.svg" alt="Mitsubishi" loading="lazy" />
          <img src="assets/brands/stanadyne.svg" alt="Stanadyne" loading="lazy" />
          <img src="assets/brands/yanmar.svg" alt="Yanmar" loading="lazy" />
          <img src="assets/brands/zexel.svg" alt="Zexel" loading="lazy" />
        </div>
      </div>
    </div>
  </div>

  <section class="map-section">
    <div class="map-header">
      <div class="container">
        <h2 class="header-text">FIND YOUR LOCAL BRANCH</h2>
      </div>
    </div>
    <div class="map-container">
      <div class="location-sidebar">
        <div class="search-container">
          <input type="text" id="location-search" placeholder="Enter a location" />
        </div>
        <div class="location-list" id="location-list">
          <!-- Locations will be populated by JavaScript -->
        </div>
      </div>
      <div class="map-wrapper">
        <div id="map"></div>
      </div>
    </div>
    <div class="map-footer"></div>
  </section>

  <footer>MTQ Engine Systems - 2025 &copy; All Rights Reserved</footer>

  <!-- Back to Top Button -->
  <button class="scroll-button back-to-top" id="backToTop" aria-label="Back to top">
  </button>

  <!-- Leaflet CSS and JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="js/map.js"></script>

  <!-- Secret Credits Easter Egg -->
  <script>
    // Check for #credits hash in URL
    function checkForCredits() {
      if (window.location.hash === '#credits') {
        showCreditsPopup();
      }
    }
    
    function showCreditsPopup() {
      // Create credits popup
      const creditsPopup = document.createElement('div');
      creditsPopup.className = 'credits-popup';
      creditsPopup.innerHTML = `
        <div class="credits-content">
          <div class="credits-header">
            <h3>ðŸŽ¨ Credits</h3>
            <button class="credits-close" aria-label="Close credits">&times;</button>
          </div>
          <div class="credits-body">
            <div class="credit-item">
              <strong>Design & Content:</strong> Rob Kemp
            </div>
            <div class="credit-item">
              <strong>Web Development:</strong> Sebastian Bertuccio
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(creditsPopup);
      
      // Add event listeners
      const closeBtn = creditsPopup.querySelector('.credits-close');
      closeBtn.addEventListener('click', closeCreditsPopup);
      
      // Close on background click
      creditsPopup.addEventListener('click', (e) => {
        if (e.target === creditsPopup) {
          closeCreditsPopup();
        }
      });
      
      // Close on escape key
      document.addEventListener('keydown', handleEscapeKey);
      
      // Remove hash from URL
      history.replaceState(null, null, window.location.pathname);
    }
    
    function closeCreditsPopup() {
      const popup = document.querySelector('.credits-popup');
      if (popup) {
        popup.remove();
        document.removeEventListener('keydown', handleEscapeKey);
      }
    }
    
    function handleEscapeKey(e) {
      if (e.key === 'Escape') {
        closeCreditsPopup();
      }
    }
    
    // Check on page load and hash change
    checkForCredits();
    window.addEventListener('hashchange', checkForCredits);
  </script>

  <!-- Background Image Fade-in Script -->
  <script>
    // Preload and fade in background image
    function initBackgroundFade() {
      const heroSection = document.querySelector('.hero-section');
      const backgroundImage = new Image();
      
      backgroundImage.onload = function() {
        // Add class to trigger fade-in effect
        heroSection.classList.add('background-loaded');
      };
      
      backgroundImage.onerror = function() {
        // If image fails to load, show background anyway (without the image)
        heroSection.classList.add('background-loaded');
      };
      
      // Start loading the background image
      backgroundImage.src = 'assets/backgrounds/landing_background.webp';
    }
    
    // Initialize background fade when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initBackgroundFade);
    } else {
      initBackgroundFade();
    }
  </script>

  <!-- Back to Top Button Script -->
  <script>
    // Back to top button functionality
    const backToTopButton = document.getElementById('backToTop');
    const scrollIndicator = document.getElementById('scrollIndicator');
    
    // Initialize scroll indicator as visible on page load
    scrollIndicator.classList.add('show');
    
    // Get brands section for border pulse animation
    const brandsSection = document.querySelector('.brands');
    
    // Initialize brands border pulse (start pulsing at top of page)
    brandsSection.classList.add('pulse-border');
    
    // Throttled scroll handler for better performance
    let scrollTimeout;
    const handleScroll = () => {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const windowHeight = window.innerHeight;
      const documentHeight = document.documentElement.scrollHeight;
      
      // Brands border pulse - only at very top of page (within 10px)
      if (scrollTop <= 10) {
        brandsSection.classList.add('pulse-border');
      } else {
        brandsSection.classList.remove('pulse-border');
      }
      
      // Smooth fade out scroll indicator when user starts scrolling
      if (scrollTop > 100) {
        scrollIndicator.classList.remove('show');
      } else {
        scrollIndicator.classList.add('show');
      }
      
      // Show back to top button when user has scrolled down 50% of the page
      if (scrollTop > (documentHeight - windowHeight) * 0.5) {
        backToTopButton.classList.add('show');
      } else {
        backToTopButton.classList.remove('show');
      }
    };
    
    // Throttle scroll events for better performance
    window.addEventListener('scroll', () => {
      if (!scrollTimeout) {
        scrollTimeout = requestAnimationFrame(() => {
          handleScroll();
          scrollTimeout = null;
        });
      }
    }, { passive: true });
    
    // Smooth scroll to top when button is clicked
    backToTopButton.addEventListener('click', () => {
      // Try modern scrollTo first, fallback to older method
      if ('scrollBehavior' in document.documentElement.style) {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      } else {
        // Fallback for older browsers
        smoothScrollTo(0, 800);
      }
    });
    
    // Scroll indicator click functionality
    scrollIndicator.addEventListener('click', () => {
      const brandsSection = document.querySelector('.brands');
      if (brandsSection) {
        // Try modern scrollIntoView first, fallback to older method
        if ('scrollBehavior' in document.documentElement.style) {
          brandsSection.scrollIntoView({
            behavior: 'smooth'
          });
        } else {
          // Fallback for older browsers
          const targetPosition = brandsSection.offsetTop;
          smoothScrollTo(targetPosition, 800);
        }
      }
    });
    
    // Fallback smooth scroll function for older browsers
    function smoothScrollTo(targetPosition, duration) {
      const startPosition = window.pageYOffset;
      const distance = targetPosition - startPosition;
      let startTime = null;
      
      function animation(currentTime) {
        if (startTime === null) startTime = currentTime;
        const timeElapsed = currentTime - startTime;
        const run = ease(timeElapsed, startPosition, distance, duration);
        window.scrollTo(0, run);
        if (timeElapsed < duration) requestAnimationFrame(animation);
      }
      
      // Easing function for smooth animation
      function ease(t, b, c, d) {
        t /= d / 2;
        if (t < 1) return c / 2 * t * t + b;
        t--;
        return -c / 2 * (t * (t - 2) - 1) + b;
      }
      
      requestAnimationFrame(animation);
    }
  </script>

  <!-- Optimized Brand Carousel Script -->
  <script>
    class BrandCarousel {
      constructor() {
        // Configuration variables
        this.pauseOnScroll = false; // Set to true to enable pause during scroll
        
        this.carousel = document.querySelector('.brand-carousel');
        this.container = document.querySelector('.brand-logos');
        this.images = Array.from(this.carousel.querySelectorAll('img'));
        this.totalImages = this.images.length / 2; // Half because we have duplicates
        
        this.currentPosition = 0;
        this.imageWidth = 0;
        this.gap = window.innerWidth <= 768 ? 40 : 60;
        this.speed = 0.8; // pixels per frame
        this.isPaused = false;
        this.isVisible = true;
        this.animationId = null;
        
        // Performance optimization flags
        this.isResizing = false;
        this.resizeTimeout = null;
        
        this.init();
      }
      
      init() {
        // Add CSS optimization
        this.carousel.style.willChange = 'transform';
        this.carousel.style.backfaceVisibility = 'hidden';
        this.carousel.style.perspective = '1000px';
        
        // Calculate image widths after they load
        this.calculateDimensions();
        
        // Start the animation
        this.animate();
        
        // Optimized resize handler with debouncing
        window.addEventListener('resize', this.debounce(() => {
          this.handleResize();
        }, 150));
        
        // Pause animation when page is not visible (performance optimization)
        document.addEventListener('visibilitychange', () => {
          this.isVisible = !document.hidden;
          if (!this.isVisible && this.animationId) {
            cancelAnimationFrame(this.animationId);
            this.animationId = null;
          } else if (this.isVisible && !this.animationId) {
            this.animate();
          }
        });
        
        // Pause animation when carousel is not in viewport
        this.setupIntersectionObserver();
        
        // Pause during scroll for performance (configurable)
        if (this.pauseOnScroll) {
          let scrollTimeout;
          window.addEventListener('scroll', () => {
            if (!this.isResizing) {
              this.isPaused = true;
              clearTimeout(scrollTimeout);
              scrollTimeout = setTimeout(() => {
                this.isPaused = false;
              }, 100);
            }
          }, { passive: true });
        }
      }
      
      setupIntersectionObserver() {
        if ('IntersectionObserver' in window) {
          const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                this.isVisible = true;
                if (!this.animationId) this.animate();
              } else {
                this.isVisible = false;
                if (this.animationId) {
                  cancelAnimationFrame(this.animationId);
                  this.animationId = null;
                }
              }
            });
          }, {
            threshold: 0.1, // Start animation when 10% visible
            rootMargin: '50px' // Start 50px before entering viewport
          });
          
          observer.observe(this.container);
        }
      }
      
      debounce(func, wait) {
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(this.resizeTimeout);
            func(...args);
          };
          clearTimeout(this.resizeTimeout);
          this.resizeTimeout = setTimeout(later, wait);
        }.bind(this);
      }
      
      handleResize() {
        this.isResizing = true;
        this.gap = window.innerWidth <= 768 ? 40 : 60;
        
        // Use RAF for resize calculations to avoid layout thrashing
        requestAnimationFrame(() => {
          this.calculateDimensions();
          setTimeout(() => {
            this.isResizing = false;
          }, 200);
        });
      }
      
      calculateDimensions() {
        // Batch DOM reads to avoid layout thrashing
        requestAnimationFrame(() => {
          // Wait for images to load
          Promise.all(this.images.slice(0, this.totalImages).map(img => {
            if (img.complete) return Promise.resolve();
            return new Promise(resolve => {
              img.onload = resolve;
              img.onerror = resolve;
            });
          })).then(() => {
            // Calculate the width of one complete set in a single batch
            let totalWidth = 0;
            for (let i = 0; i < this.totalImages; i++) {
              totalWidth += this.images[i].offsetWidth + this.gap;
            }
            this.oneSetWidth = totalWidth;
          });
        });
      }
      
      animate() {
        if (this.isVisible && !this.isPaused && this.oneSetWidth) {
          this.currentPosition += this.speed;
          
          // Reset position when we've moved one complete set
          if (this.currentPosition >= this.oneSetWidth) {
            this.currentPosition = 0;
          }
          
          // Use transform3d for hardware acceleration
          this.carousel.style.transform = `translate3d(-${this.currentPosition}px, 0, 0)`;
        }
        
        this.animationId = requestAnimationFrame(() => this.animate());
      }
      
      pause() {
        this.isPaused = true;
      }
      
      resume() {
        this.isPaused = false;
      }
    }
    
    // Initialize carousel when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      new BrandCarousel();
    });
  </script>
</body>
</html>
