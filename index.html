<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cornell Diesel Systems</title>
  <link rel="stylesheet" href="css/main.css" />
</head>
<body>
  <div class="hero-section">
    <div class="container">
      <header>
        <img src="assets/logos/cornell_logo_white_optimized.svg" alt="Cornell Diesel Systems Logo" class="main-logo" />
      </header>

      <section class="announcement">
        <h1 class="">Cornell Diesel Systems is now MTQ Engine Systems</h1>
        <p>
          We are excited to announce the consolidation of Cornell Diesel Systems with MTQ Engine Systems,
          combining our strengths to create a <span class="bold">One Stop Shop</span> for all your Diesel Fuel Injection, 
          Turbocharger, and Performance sales & service solutions.
        </p>
        <p>
            <span class="bold italic">"Same Great Service and Familiar Team"</span>
        </p>
        <p>
          This represents more than just a name change, it reflects our commitment to continuous improvement, and
          enhanced customer service. Together, Cornell and MTQ Engine Systems are positioned to deliver even greater value, 
          reliability, and nationwide support to our customers.
        </p>
        <p>
          For now, you can still access information and resources directly on the respective company websites.
        </p>
        <p>Please use links below.</p>
      </section>

      <div class="links">
        <a href="https://www.cornells.com.au" target="_blank"><div class="btn-link cornell-border"><img src="assets/logos/cornell_logo_1.png" alt="Cornell Website" /></div></a>
        <a href="https://www.mtqes.com.au" target="_blank"><div class="btn-link mtq-border"><img src="assets/logos/mtq_logo_1.png" alt="MTQ Website" /></div></a>
      </div>

      <div class="main-logo">
        <img src="assets/logos/mtq_logo_white.svg" alt="MTQ Engine Systems Full Logo" />
      </div>
    </div>
    
    <!-- Scroll Indicator -->
    <div class="scroll-indicator" id="scrollIndicator"></div>
  </div>

  <div class="brands">
    <div class="container">
      <h2 class="header-text header-text-larger">HOME TO THE WORLD'S LEADING BRANDS</h2>
      <div class="brand-logos">
        <div class="brand-carousel">
          <!-- First set of brands -->
          <img src="assets/brands/borgwarner.svg" alt="BorgWarner" />
          <img src="assets/brands/bosch.svg" alt="Bosch" />
          <img src="assets/brands/continental.svg" alt="Continental" />
          <img src="assets/brands/delphi.svg" alt="Delphi" />
          <img src="assets/brands/denso.svg" alt="Denso" />
          <img src="assets/brands/garrett.svg" alt="Garrett" />
          <img src="assets/brands/holset.svg" alt="Holset" />
          <img src="assets/brands/ihi.svg" alt="IHI" />
          <img src="assets/brands/mitsubishi.svg" alt="Mitsubishi" />
          <img src="assets/brands/stanadyne.svg" alt="Stanadyne" />
          <img src="assets/brands/yanmar.svg" alt="Yanmar" />
          <img src="assets/brands/zexel.svg" alt="Zexel" />
          <!-- Duplicate set for seamless loop -->
          <img src="assets/brands/borgwarner.svg" alt="BorgWarner" />
          <img src="assets/brands/bosch.svg" alt="Bosch" />
          <img src="assets/brands/continental.svg" alt="Continental" />
          <img src="assets/brands/delphi.svg" alt="Delphi" />
          <img src="assets/brands/denso.svg" alt="Denso" />
          <img src="assets/brands/garrett.svg" alt="Garrett" />
          <img src="assets/brands/holset.svg" alt="Holset" />
          <img src="assets/brands/ihi.svg" alt="IHI" />
          <img src="assets/brands/mitsubishi.svg" alt="Mitsubishi" />
          <img src="assets/brands/stanadyne.svg" alt="Stanadyne" />
          <img src="assets/brands/yanmar.svg" alt="Yanmar" />
          <img src="assets/brands/zexel.svg" alt="Zexel" />
        </div>
      </div>
    </div>
  </div>

  <section class="map-section">
    <div class="map-header">
      <div class="container">
        <h2 class="header-text">FIND YOUR LOCAL BRANCH</h2>
      </div>
    </div>
    <div class="map-container">
      <div class="location-sidebar">
        <div class="search-container">
          <input type="text" id="location-search" placeholder="Enter a location" />
        </div>
        <div class="location-list" id="location-list">
          <!-- Locations will be populated by JavaScript -->
        </div>
      </div>
      <div class="map-wrapper">
        <div id="map"></div>
      </div>
    </div>
    <div class="map-footer"></div>
  </section>

  <footer>MTQ Engine Systems - 2025 &copy; All Rights Reserved</footer>

  <!-- Back to Top Button -->
  <button class="back-to-top" id="backToTop" aria-label="Back to top">
  </button>

  <!-- Leaflet CSS and JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="js/map.js"></script>

  <!-- Back to Top Button Script -->
  <script>
    // Back to top button functionality
    const backToTopButton = document.getElementById('backToTop');
    const scrollIndicator = document.getElementById('scrollIndicator');
    
    // Show/hide button based on scroll position
    window.addEventListener('scroll', () => {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const windowHeight = window.innerHeight;
      const documentHeight = document.documentElement.scrollHeight;
      
      // Hide scroll indicator when user starts scrolling
      if (scrollTop > 50) {
        scrollIndicator.style.opacity = '0';
        scrollIndicator.style.visibility = 'hidden';
      } else {
        scrollIndicator.style.opacity = '0.8';
        scrollIndicator.style.visibility = 'visible';
      }
      
      // Show back to top button when user has scrolled down 70% of the page
      if (scrollTop > (documentHeight - windowHeight) * 0.7) {
        backToTopButton.classList.add('show');
      } else {
        backToTopButton.classList.remove('show');
      }
    });
    
    // Smooth scroll to top when button is clicked
    backToTopButton.addEventListener('click', () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
    
    // Scroll indicator click functionality
    scrollIndicator.addEventListener('click', () => {
      const brandsSection = document.querySelector('.brands');
      if (brandsSection) {
        brandsSection.scrollIntoView({
          behavior: 'smooth'
        });
      }
    });
  </script>

  <!-- Optimized Brand Carousel Script -->
  <script>
    class BrandCarousel {
      constructor() {
        // Configuration variables
        this.pauseOnScroll = false; // Set to true to enable pause during scroll
        
        this.carousel = document.querySelector('.brand-carousel');
        this.container = document.querySelector('.brand-logos');
        this.images = Array.from(this.carousel.querySelectorAll('img'));
        this.totalImages = this.images.length / 2; // Half because we have duplicates
        
        this.currentPosition = 0;
        this.imageWidth = 0;
        this.gap = window.innerWidth <= 768 ? 40 : 60;
        this.speed = 0.8; // pixels per frame
        this.isPaused = false;
        this.isVisible = true;
        this.animationId = null;
        
        // Performance optimization flags
        this.isResizing = false;
        this.resizeTimeout = null;
        
        this.init();
      }
      
      init() {
        // Add CSS optimization
        this.carousel.style.willChange = 'transform';
        this.carousel.style.backfaceVisibility = 'hidden';
        this.carousel.style.perspective = '1000px';
        
        // Calculate image widths after they load
        this.calculateDimensions();
        
        // Start the animation
        this.animate();
        
        // Optimized resize handler with debouncing
        window.addEventListener('resize', this.debounce(() => {
          this.handleResize();
        }, 150));
        
        // Pause animation when page is not visible (performance optimization)
        document.addEventListener('visibilitychange', () => {
          this.isVisible = !document.hidden;
          if (!this.isVisible && this.animationId) {
            cancelAnimationFrame(this.animationId);
            this.animationId = null;
          } else if (this.isVisible && !this.animationId) {
            this.animate();
          }
        });
        
        // Pause during scroll for performance (configurable)
        if (this.pauseOnScroll) {
          let scrollTimeout;
          window.addEventListener('scroll', () => {
            if (!this.isResizing) {
              this.isPaused = true;
              clearTimeout(scrollTimeout);
              scrollTimeout = setTimeout(() => {
                this.isPaused = false;
              }, 100);
            }
          }, { passive: true });
        }
      }
      
      debounce(func, wait) {
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(this.resizeTimeout);
            func(...args);
          };
          clearTimeout(this.resizeTimeout);
          this.resizeTimeout = setTimeout(later, wait);
        }.bind(this);
      }
      
      handleResize() {
        this.isResizing = true;
        this.gap = window.innerWidth <= 768 ? 40 : 60;
        
        // Use RAF for resize calculations to avoid layout thrashing
        requestAnimationFrame(() => {
          this.calculateDimensions();
          setTimeout(() => {
            this.isResizing = false;
          }, 200);
        });
      }
      
      calculateDimensions() {
        // Batch DOM reads to avoid layout thrashing
        requestAnimationFrame(() => {
          // Wait for images to load
          Promise.all(this.images.slice(0, this.totalImages).map(img => {
            if (img.complete) return Promise.resolve();
            return new Promise(resolve => {
              img.onload = resolve;
              img.onerror = resolve;
            });
          })).then(() => {
            // Calculate the width of one complete set in a single batch
            let totalWidth = 0;
            for (let i = 0; i < this.totalImages; i++) {
              totalWidth += this.images[i].offsetWidth + this.gap;
            }
            this.oneSetWidth = totalWidth;
          });
        });
      }
      
      animate() {
        if (this.isVisible && !this.isPaused && this.oneSetWidth) {
          this.currentPosition += this.speed;
          
          // Reset position when we've moved one complete set
          if (this.currentPosition >= this.oneSetWidth) {
            this.currentPosition = 0;
          }
          
          // Use transform3d for hardware acceleration
          this.carousel.style.transform = `translate3d(-${this.currentPosition}px, 0, 0)`;
        }
        
        this.animationId = requestAnimationFrame(() => this.animate());
      }
      
      pause() {
        this.isPaused = true;
      }
      
      resume() {
        this.isPaused = false;
      }
    }
    
    // Initialize carousel when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      new BrandCarousel();
    });
  </script>
</body>
</html>
